\section{Design}

O design de sistemas de informação voltados à fiscalização cidadã deve conciliar requisitos aparentemente conflitantes: robustez suficiente para processar grandes volumes de dados governamentais, simplicidade operacional compatível com equipes reduzidas, e acessibilidade que permita ao cidadão comum compreender informações complexas. Conforme o paradigma de Design Science Research adotado neste trabalho \cite{hevner2004design}, as decisões de design devem ser orientadas tanto pela utilidade prática do artefato quanto pelo rigor teórico que fundamenta cada escolha.

Esta seção organiza as decisões técnicas em quatro dimensões interdependentes: a arquitetura de software que estrutura o sistema, o conjunto de tecnologias que a implementa, a estratégia de ingestão que alimenta a base de dados, e o modelo relacional que organiza as informações. Cada decisão é apresentada com suas alternativas consideradas e a justificativa para a escolha final, seguindo a tradição de documentação arquitetural proposta por Dragoni \textit{et al.} (\citeyear{dragoni2017microservices}).

\subsection{Arquitetura do Sistema}

A escolha arquitetural representa uma das decisões mais consequentes em projetos de software. Conforme já apresentado e justificado na Introdução, optou-se pela arquitetura de \textbf{monolito modular}. Esta abordagem combina a organização interna característica de microsserviços --- com fronteiras claras entre domínios de negócio --- com a simplicidade operacional necessária ao contexto acadêmico, eliminando a complexidade de orquestração distribuída.

\subsubsection{Organização em Módulos}

A estrutura interna segue os princípios de \textit{Bounded Contexts} do \textit{Domain-Driven Design} \cite{evans2003ddd}, onde cada módulo representa um contexto de domínio com responsabilidades claramente delimitadas. O diretório \texttt{internal/} organiza-se em cinco módulos principais, cada um encapsulando um aspecto da fiscalização parlamentar:

\begin{itemize}
    \item \texttt{internal/senador}: Gerencia dados cadastrais e mandatos históricos, atuando como ``fonte de verdade'' para identificação de parlamentares;
    \item \texttt{internal/ceaps}: Processa despesas da Cota Parlamentar, implementando detecção de anomalias e agregações por categoria;
    \item \texttt{internal/votacao}: Coleta votações nominais e calcula métricas como presença e fidelidade partidária;
    \item \texttt{internal/emenda}: Integra dados do Portal da Transparência, com tratamento especial para ``emendas PIX'';
    \item \texttt{internal/ranking}: Orquestra o cálculo de pontuações conforme metodologia definida na Seção~3.3.
\end{itemize}

Módulos transversais complementam a estrutura: \texttt{internal/api} expõe \textit{endpoints} REST, \texttt{internal/scheduler} gerencia tarefas agendadas, e \texttt{internal/cache} abstrai operações no \textit{Redis}. Os módulos comunicam-se exclusivamente através de interfaces \textit{Go}, respeitando o princípio de inversão de dependência.

\subsubsection{Visão de Implantação}

A Figura~\ref{fig:implantacao} apresenta a arquitetura de implantação do sistema, ilustrando o fluxo de dados desde as fontes governamentais até o usuário final. Tanto o \textit{back-end} quanto o \textit{front-end} são executados em contêineres no \textit{Google Cloud Run}, garantindo escalabilidade unificada. O \textit{back-end} consome dados armazenados em \textit{PostgreSQL} (\textit{Cloud SQL}) e \textit{Redis} (\textit{Memorystore}), enquanto o \textit{scheduler} opera como um módulo interno do serviço principal, aproveitando a mesma infraestrutura.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.95\textwidth]{src/images/arquitetura-implantacao.png}
    \caption{Arquitetura de implantação do sistema Tô De Olho}
    \label{fig:implantacao}
    \par\small{Fonte: Autoria Própria}
\end{figure}

\subsection{Stack Tecnológico}

A seleção de tecnologias foi orientada por três critérios: desempenho em cenários de alta concorrência (característicos de \textit{pipelines} de ingestão), manutenibilidade a longo prazo (considerando a natureza \textit{open-source} do projeto), e adequação ao domínio (priorizando ferramentas com suporte robusto a operações analíticas).

\subsubsection{\textit{Back-end} em \textit{Go}}

A linguagem \textit{Go} foi selecionada após avaliação comparativa com \textit{Node.js} e \textit{Python}. O fator decisivo foi o modelo de \textbf{\textit{goroutines}}: \textit{threads} leves gerenciadas pelo \textit{runtime}, consumindo aproximadamente 2KB de memória inicial --- em contraste com cerca de 1MB por \textit{thread} de sistema operacional \cite{nanz2015comparative}. Essa eficiência viabiliza o processamento paralelo de centenas de requisições \textit{HTTP} durante a ingestão.

O \textit{framework} \textbf{\textit{Gin}} foi escolhido por seu roteamento baseado em árvore de prefixos (\textit{radix tree}), com desempenho até 40 vezes superior a alternativas \cite{lie2024golang}. O \textit{ORM} \textbf{\textit{GORM}} oferece migrações automáticas e operações de \textit{upsert} essenciais para evitar duplicação de registros. Para ambientes de produção, o sistema implementa agrupamento de conexões (\textit{connection pooling}) com limites configuráveis de conexões ociosas e máximas.

\subsubsection{Camada de Persistência}

\textbf{\textit{PostgreSQL}} foi selecionado por sua robustez em consultas analíticas e suporte a \textit{CTEs} (\textit{Common Table Expressions}), essenciais para agregações complexas. Originado em 1986 na \textit{UC Berkeley} \cite{stonebraker1986postgres}, o banco garante conformidade \textit{ACID} crítica para operações de ingestão concorrente.

\textbf{\textit{Redis}} atua como \textit{cache} para listas pré-computadas, alcançando latências de 100--500 microssegundos por operação \cite{redis2024}. Esta camada evita recálculos custosos a cada requisição, materializando resultados após cada ciclo de sincronização.

\subsubsection{\textit{Front-end} em \textit{Next.js}}

A escolha de \textbf{\textit{Next.js} 16} justifica-se pela necessidade crítica de indexação por mecanismos de busca \cite{salim2024nextjs}. Diferentemente de \textit{SPAs} que renderizam conteúdo apenas via \textit{JavaScript}, \textit{Next.js} oferece renderização no servidor (\textit{Server-Side Rendering} - SSR) e geração estática (\textit{Static Site Generation} - SSG), entregando \textit{HTML} pré-renderizado aos robôs de indexação (\textit{crawlers}) --- requisito fundamental para plataformas de fiscalização que dependem de descoberta orgânica.

A biblioteca \textbf{\textit{Recharts}} foi selecionada para visualização de dados por sua integração declarativa com \textit{React}. \textbf{\textit{Tailwind CSS 4}} permite desenvolvimento ágil com classes utilitárias e geração otimizada de \textit{CSS} em produção \cite{tailwindcss2024}.

A escolha do \textbf{\textit{Bun}} como \textit{runtime JavaScript} fundamenta-se em estudos comparativos recentes que demonstram seu desempenho superior em operações síncronas e processamento \textit{JSON} \cite{smirnov2024bun}. Diferentemente do \textit{Node.js}, que utiliza o motor \textit{V8}, o \textit{Bun} é construído sobre o \textit{JavaScriptCore} (\textit{WebKit}), resultando em tempos de inicialização significativamente menores --- característica vantajosa para o ciclo de desenvolvimento iterativo. Além do \textit{runtime}, o \textit{Bun} incorpora gerenciador de pacotes nativo, eliminando a necessidade de gerenciadores de pacotes externos e simplificando o processo de construção.

\subsection{Estratégia de Ingestão de Dados}

A consolidação de dados dispersos em três \textit{APIs} governamentais representa um dos desafios centrais do projeto. O processo adota o paradigma \textit{Extract, Transform, Load} (ETL), que, segundo \citeonline{vassiliadis2009survey}, consome tipicamente entre 60\% e 80\% do esforço em projetos de \textit{data warehousing}.

A estratégia combina duas abordagens: \textbf{\textit{backfill}} para a carga inicial e \textbf{sincronização contínua} para manutenção incremental. Conforme \citeonline{kimball2013toolkit}, operações de carga histórica devem priorizar a vazão (\textit{throughput}) em detrimento da latência. Para isso, o sistema utiliza arquivos \textit{CSV} e inserções em lote (\textit{bulk inserts}). O recorte temporal define-se de 2023 ao presente, cobrindo a legislatura atual e garantindo a pertinência dos dados para fiscalização ativa, embora a arquitetura suporte a ingestão de séries históricas mais longas.

Para o módulo de emendas, o \textit{backfill} utiliza o \textit{CSV} consolidado do Portal da Transparência. Para lidar com o grande volume de dados sem exaurir a memória do servidor, o processamento emprega \textbf{leitura em fluxo contínuo} (\textit{streaming}) --- técnica que processa o arquivo linha a linha em vez de carregá-lo inteiramente na memória RAM. Adicionalmente, o sistema implementa algoritmos de \textbf{detecção automática de separadores} (vírgulas ou ponto-e-vírgula), garantindo robustez contra inconsistências de formatação comuns em arquivos governamentais. Como a identificação do autor da emenda é textual, o processo aplica normalização de grafia (remoção de acentos, espaços e pontuação) para casar \textit{nomeAutor} com o cadastro de senadores. A idempotência --- propriedade que garante o mesmo resultado independentemente do número de execuções --- é assegurada por chave composta \texttt{(codigoEmenda, senador\_id, ano)}, utilizando o comando \textit{ON CONFLICT} para realizar a inserção ou atualização condicional (\textit{upsert}).

A manutenção da base de dados opera através de um mecanismo de \textit{polling} periódico --- técnica onde o sistema consulta ativamente as fontes oficiais em intervalos regulares. O sistema utiliza agendadores internos (\textit{tickers}) calibrados para realizar a \textbf{atualização diária} integral de todos os domínios de dados do sistema, garantindo que as informações apresentadas ao cidadão tenham, no máximo, 24 horas de latência em relação às fontes oficiais.

A consistência segue o modelo de entrega \textit{at-least-once} (pelo menos uma vez), sustentada por uma arquitetura de persistência idempotente que impede a duplicação de registros durante reprocessamentos, garantindo integridade sem intervenção manual. Quanto à resiliência, os clientes \textit{HTTP} implementam tempos limite (\textit{timeouts}) conservadores de 120 segundos para lidar com a latência variável das \textit{APIs} públicas, permitindo que o ciclo de sincronização prossiga ou falhe de maneira controlada sem comprometer a estabilidade do serviço.

\subsection{Modelo de Dados}

O modelo relacional constitui o alicerce sobre o qual todas as funcionalidades são construídas. O projeto priorizou dois objetivos: garantir integridade referencial durante ingestão concorrente, e otimizar consultas analíticas frequentes como agregações de gastos por senador, período e categoria.

As entidades organizam-se em torno de \textbf{Senador}, a entidade central identificada por código parlamentar único. Relacionamentos 1:N conectam o senador a: \textbf{Mandato} (legislatura, tipo, período), \textbf{Despesa CEAPS} (com chave composta para idempotência), \textbf{Votação} (tabela associativa com sessão), \textbf{Servidor de Gabinete} (nome, cargo, remuneração), \textbf{Emenda} (incluindo Transferências Especiais) e \textbf{Comissão Membro} (participação com cargo e período).

A Figura~\ref{fig:er-diagram} apresenta o esquema relacional de dados consolidado.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{src/images/esquema_relacional.png}
    \caption{Esquema Relacional de Dados do sistema Tô De Olho}
    \label{fig:er-diagram}
    \par\small{Fonte: Autoria Própria}
\end{figure}

Para otimizar consultas frequentes, foram criados os seguintes índices compostos:

\begin{itemize}
    \item \texttt{idx\_despesa\_senador\_ano} --- totalização de gastos por período;
    \item \texttt{idx\_votacao\_unica} --- chave composta (senador, sessão) para cálculo de presença;
    \item \texttt{idx\_emenda\_unique} --- garantia de idempotência (senador, ano, número);
    \item \texttt{idx\_comissao\_senador} --- agregação de participação em comissões.
\end{itemize}


